# Textor

A safe, deterministic scaffolding and refactoring tool for Astro + modern frontend projects.

## Overview

Textor enforces clear separation of concerns in your Astro projects:

- **Pages** = Routing adapters (thin)
- **Features** = Implementation modules (self-contained)  
- **Components** = Reusable UI primitives (shared)

All operations are safe, reversible, and configurable. No magic, no hardcoded paths.

## Installation

```bash
# In your Astro project
pnpm add -D textor # or npm install -D textor

# Initialize configuration
pnpm textor init   # or npx textor init
```

This creates `.textor/config.json` with default settings.

## Quick Start

### 1. Add a Section (Route + Feature)

```bash
pnpm textor add-section /users users/catalog --layout Main
```

**Creates:**
```
src/pages/users.astro              # Route adapter
src/features/users/catalog/
  ├── UsersCatalog.astro           # Feature component
  ├── sub-components/              # Feature-specific components
  └── scripts/
      └── index.ts                 # Feature logic
```

**Route file (`src/pages/users.astro`):**
```astro
<!-- @generated by Textor -->
---
import Main from '../layouts/Main.astro';
import UsersCatalog from '../features/users/catalog/UsersCatalog';
---

<Main>
  <UsersCatalog />
</Main>
```

**Feature file (`src/features/users/catalog/UsersCatalog.astro`):**
```astro
<!-- @generated by Textor -->
---
// Feature: UsersCatalog
---

<div class="userscatalog">
  <h1>UsersCatalog</h1>
</div>
<script src="./scripts/index.ts"></script>
```

### 2. Create a Component

```bash
pnpm textor create-component Button
```

**Creates:**
```
src/components/Button/
├── __tests__/
│   └── Button.test.tsx            # Component tests
├── sub-components/                # Sub-components
├── config/
│   └── index.ts                   # Configuration
├── constants/
│   └── index.ts                   # Constants
├── context/
│   └── ButtonContext.tsx          # Context provider
├── hooks/
│   └── useButton.ts               # Component hook
├── types/
│   └── index.ts                   # Types
├── Button.astro                   # Component implementation
└── index.ts                       # Public entry point
```

Skip files you don't need:
```bash
pnpm textor create-component Card --no-context --no-hook --no-sub-components-dir
```

### 3. Move a Section

```bash
# Full syntax
pnpm textor move-section /users users/catalog /members members/list

# State-based shortcut (Textor remembers the association)
pnpm textor move-section /users /members
```

Moves files, updates imports, cleans up empty directories.

### 4. List Sections

```bash
pnpm textor list-sections
```

Shows all routes, features, and shared components currently managed by Textor.

### 5. Remove a Section

```bash
# Full syntax
pnpm textor remove-section /users users/catalog

# State-based shortcut
pnpm textor remove-section /users
```

Only deletes files with Textor signature unless `--force` is used.

## Commands

### `init`

Initialize Textor configuration.

```bash
pnpm textor init [--force]
```

### `add-section`

Create a route + feature binding.

```bash
pnpm textor add-section <route> <featurePath> [options]
```

**Options:**
- `--layout <name>` - Layout component name (default: "Main")
- `--name <name>` - Custom name for the section (for easier tracking)
- `--dry-run` - Preview without creating
- `--force` - Overwrite existing files

**Examples:**
```bash
pnpm textor add-section / home --layout Main
pnpm textor add-section /users users/catalog --name Catalog
pnpm textor add-section /products/[id] products/detail --layout Shop
```

### `remove-section`

Remove a section safely.

```bash
pnpm textor remove-section <route|name> [featurePath] [options]
```

**Options:**
- `--keep-feature` - Keep feature, remove route only
- `--keep-route` - Keep route, remove feature only
- `--dry-run` - Preview without deleting
- `--force` - Delete non-Textor files too

**Examples:**
```bash
pnpm textor remove-section /users
pnpm textor remove-section Catalog
pnpm textor remove-section /old old/feature --force
```

### `move-section`

Move and rename sections.

```bash
# Using state (simplest)
pnpm textor move-section <route|name> <toRoute> [options]

# Manual paths
pnpm textor move-section <fromRoute> <fromFeature> <toRoute> <toFeature> [options]
```

**Options:**
- `--keep-feature` - Move route only
- `--dry-run` - Preview without moving
- `--force` - Overwrite existing files

**Examples:**
```bash
pnpm textor move-section /old /new
pnpm textor move-section Catalog /members
pnpm textor move-section /old old/feature /new new/feature
```

### `create-component`

Create reusable UI components. Textor tracks these for easy removal.

```bash
pnpm textor create-component <ComponentName> [options]
```

**Options:**
- `--no-context` - Skip context file
- `--no-hook` - Skip hook file
- `--no-tests` - Skip test file
- `--no-config` - Skip config file
- `--no-constants` - Skip constants file
- `--no-sub-components-dir` - Skip sub-components directory
- `--dry-run` - Preview without creating
- `--force` - Overwrite existing files

**Examples:**
```bash
pnpm textor create-component Button
pnpm textor create-component Card --no-context --no-hook
pnpm textor create-component Modal --dry-run
```

### `remove-component`

Remove a reusable UI component safely.

```bash
pnpm textor remove-component <ComponentName> [options]
```

**Options:**
- `--dry-run` - Preview without deleting
- `--force` - Delete non-Textor files too

**Examples:**
```bash
pnpm textor remove-component Button
pnpm textor remove-component Card --dry-run
```

### `list-sections`

List all sections and components managed by Textor.

```bash
pnpm textor list-sections
```

Shows the route, its name, the feature path it uses, and all shared components tracked in the state.

## Configuration

All behavior is controlled by `.textor/config.json`:

```json
{
  "paths": {
    "pages": "src/pages",
    "features": "src/features",
    "components": "src/components",
    "layouts": "src/layouts"
  },
  "importAliases": {
    "layouts": "@/layouts",
    "features": "@/features"
  },
  "naming": {
    "routeExtension": ".astro",
    "featureExtension": ".astro",
    "componentExtension": ".astro",
    "hookExtension": ".ts",
    "testExtension": ".test.tsx"
  },
  "signatures": {
    "astro": "<!-- @generated by Textor -->",
    "typescript": "// @generated by Textor",
    "javascript": "// @generated by Textor"
  },
  "features": {
    "createSubComponentsDir": true,
    "createScriptsDir": true,
    "scriptsIndexFile": "scripts/index.ts"
  },
  "components": {
    "createSubComponentsDir": true,
    "createContext": true,
    "createHook": true,
    "createTests": true,
    "createConfig": true,
    "createConstants": true,
    "createTypes": true
  }
}
```

Note: `importAliases` are optional. If a section is empty or missing an alias, Textor will use relative paths for those imports.

### Customize for Your Project

```json
{
  "paths": {
    "pages": "app/routes",
    "features": "app/modules"
  },
  "naming": {
    "routeExtension": ".tsx",
    "featureExtension": ".tsx"
  }
}
```

## Template Overrides

You can customize the generated code by creating your own templates in `.textor/templates/`.

Supported templates:
- `route.astro`: Template for route adapter files
- `feature.astro`: Template for main feature components
- `component.astro`: Template for shared components
- `hook.astro`: Template for component hooks
- `context.astro`: Template for component context providers
- `test.astro`: Template for component tests

Templates use `{{variable}}` syntax for dynamic values.

**Example `route.astro` override:**
```astro
---
import {{layoutName}} from '{{layoutImportPath}}';
import {{featureComponentName}} from '{{featureImportPath}}';
---

<{{layoutName}} title="Custom Page">
  <{{featureComponentName}} />
</{{layoutName}}>
```

Available variables depend on the template:
- All: `{{componentName}}`
- Route: `{{layoutName}}`, `{{layoutImportPath}}`, `{{featureImportPath}}`, `{{featureComponentName}}`
- Hook: `{{hookName}}`
- Test: `{{componentPath}}`

## Safety Features

### State Tracking

When you create a section or component, Textor records its metadata in `.textor/state.json`. This allows you to perform operations using only a name or route:

```bash
# Textor knows 'Catalog' is /users -> users/catalog
pnpm textor remove-section Catalog

# Textor knows 'Button' is at src/components/Button/
pnpm textor remove-component Button
```

State tracking also enables automatic feature path calculation during moves and maintains a registry of all managed components.

### Signature-Based Tracking

All generated files include:
```astro
<!-- @generated by Textor -->
```
```typescript
// @generated by Textor
```

This enables safe deletion, moving, and refactoring.

### Protection Mechanisms

- ❌ Won't overwrite existing files without `--force`
- ❌ Won't delete non-Textor files without `--force`
- ✅ Dry-run mode for all destructive operations
- ✅ Automatic cleanup of empty directories
- ✅ Automatic import updates when moving

## Naming Conventions

### Routes to Files
```
/              → index.astro
/users         → users.astro
/users/[id]    → users/[id].astro
```

### Features to Components
```
users/catalog     → UsersCatalog.astro
auth/sign-in      → AuthSignIn.astro
admin/dashboard   → AdminDashboard.astro
```

### Components to Hooks
```
Button        → useButton.ts
UserProfile   → useUserProfile.ts
```

## Project Structure

```
textor/
├── bin/
│   └── textor.js              # CLI entry point
├── src/
│   ├── commands/              # Command implementations
│   │   ├── init.js
│   │   ├── add-section.js
│   │   ├── remove-section.js
│   │   ├── move-section.js
│   │   ├── create-component.js
│   │   ├── remove-component.js
│   │   └── list-sections.js
│   └── utils/                 # Shared utilities
│       ├── config.js          # Configuration management
│       ├── naming.js          # Naming transformations
│       ├── filesystem.js      # Safe file operations
│       ├── state.js           # State management
│       └── templates.js       # Code generation
├── test/
│   ├── naming.test.js         # Naming unit tests
│   ├── config.test.js         # Config unit tests
│   ├── alias.test.js          # Alias and relative path tests
│   ├── state.test.js          # State management tests
│   └── improvements.test.js   # New features tests
├── scripts/
│   └── validate.js            # Installation validator
├── examples/
│   └── config.example.json    # Example config
└── package.json
```

## Examples

### Building a Blog

```bash
# Home page
pnpm textor add-section / blog/home --layout Main

# Post detail
pnpm textor add-section /posts/[slug] blog/post-detail --layout Main

# Create page
pnpm textor add-section /posts/create blog/post-create --layout Main

# Reusable components
pnpm textor create-component Card
pnpm textor create-component Button
```

### E-Commerce Site

```bash
# Product pages
pnpm textor add-section / shop/home --layout Shop
pnpm textor add-section /products shop/product-listing --layout Shop
pnpm textor add-section /products/[id] shop/product-detail --layout Shop

# Cart
pnpm textor add-section /cart shop/cart --layout Shop

# Components
pnpm textor create-component ProductCard
pnpm textor create-component CartItem
```

### Refactoring

```bash
# Preview the move
pnpm textor move-section /old old/feature /new new/feature --dry-run

# Execute the move
pnpm textor move-section /old old/feature /new new/feature

# Verify with git
git diff
```

## Testing

```bash
# Run tests
pnpm test

# Validate installation
node scripts/validate.js
```

## Design Principles

1. **Explicit over implicit** - No magic behavior
2. **Safe by default** - Refuse to delete hand-written code
3. **Configurable over hardcoded** - Everything in config
4. **Reversible operations** - Add, remove, move all supported
5. **Predictable structure** - Same result every time

## Use Cases

### Perfect For
- Large teams needing consistency
- Refactoring existing codebases
- Teaching architecture patterns
- CI/CD automation
- Monorepos with shared conventions

### Not Ideal For
- Small hobby projects (too structured)
- Projects with existing strong patterns
- Teams preferring full freedom

## Troubleshooting

### Config Not Found
```bash
Error: Configuration not found
Solution: pnpm textor init
```

### File Already Exists
```bash
Error: File already exists
Solution: Remove file or use --force
```

### Not Generated by Textor
```bash
Error: Refusing to delete - not generated by Textor
Solution: Add signature manually or use --force
```

## Contributing

See `CONTRIBUTING.md` for development guidelines.

## License

MIT

## Philosophy

Textor is built on the belief that good tooling should:
- **Teach** - Structure should be self-explanatory
- **Protect** - Prevent mistakes rather than move fast
- **Adapt** - Be configurable, not opinionated
- **Reverse** - Always provide an undo path

It's designed to feel like something a principal engineer would approve - safe, predictable, and production-ready.
