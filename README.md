# Textor

A safe, deterministic scaffolding and refactoring tool for Astro + modern frontend projects.

## Overview

Textor enforces clear separation of concerns in your Astro projects:

- **Pages** = Routing adapters (thin)
- **Features** = Implementation modules (self-contained)  
- **Components** = Reusable UI primitives (shared)

All operations are safe, reversible, and configurable. No magic, no hardcoded paths.

## Installation

```bash
# In your Astro project
pnpm add -D textor # or npm install -D textor

# Initialize configuration
pnpm textor init   # or npx textor init
```

This creates `.textor/config.json` with default settings.

## Quick Start

### 1. Add a Section (Route + Feature)

```bash
pnpm textor add-section /users users/catalog --layout Main
```

**Creates:**
```
src/pages/users.astro              # Route adapter
src/features/users/catalog/
  ├── UsersCatalog.astro           # Feature component
  ├── Components/                  # Feature-specific components
  └── Scripts/
      └── index.ts                 # Feature logic
```

**Route file (`src/pages/users.astro`):**
```astro
<!-- @generated by Textor -->
---
import Main from '../layouts/Main.astro';
import UsersCatalog from '../features/users/catalog/UsersCatalog';
---

<Main>
  <UsersCatalog />
</Main>
```

### 2. Create a Component

```bash
pnpm textor create-component Button
```

**Creates:**
```
src/components/Button/
  ├── Button.astro
  ├── ButtonContext.tsx
  ├── useButton.ts
  ├── Button.test.tsx
  ├── ButtonConfig.ts
  └── ButtonConstants.ts
```

Skip files you don't need:
```bash
pnpm textor create-component Card --no-context --no-hook
```

### 3. Move a Section

```bash
pnpm textor move-section /users users/catalog /members members/list
```

Moves files, updates imports, cleans up empty directories.

### 4. Remove a Section

```bash
# Preview what will be deleted
pnpm textor remove-section /users users/catalog --dry-run

# Delete it
pnpm textor remove-section /users users/catalog
```

Only deletes files with Textor signature unless `--force` is used.

## Commands

### `init`

Initialize Textor configuration.

```bash
pnpm textor init [--force]
```

### `add-section`

Create a route + feature binding.

```bash
pnpm textor add-section <route> <featurePath> [--layout <name>]
```

**Examples:**
```bash
pnpm textor add-section / home --layout Main
pnpm textor add-section /users users/catalog --layout Main
pnpm textor add-section /products/[id] products/detail --layout Shop
```

### `remove-section`

Remove a section safely.

```bash
pnpm textor remove-section <route> <featurePath> [options]
```

**Options:**
- `--keep-feature` - Keep feature, remove route only
- `--keep-route` - Keep route, remove feature only
- `--dry-run` - Preview without deleting
- `--force` - Delete non-Textor files too

**Examples:**
```bash
pnpm textor remove-section /users users/catalog --dry-run
pnpm textor remove-section /old old/feature --force
```

### `move-section`

Move and rename sections.

```bash
pnpm textor move-section <fromRoute> <fromFeature> <toRoute> <toFeature> [options]
```

**Options:**
- `--keep-feature` - Move route only
- `--dry-run` - Preview without moving
- `--force` - Overwrite existing files

**Examples:**
```bash
pnpm textor move-section /old old/feature /new new/feature
pnpm textor move-section /old /new --keep-feature
```

### `create-component`

Create reusable UI components.

```bash
pnpm textor create-component <ComponentName> [options]
```

**Options:**
- `--no-context` - Skip context file
- `--no-hook` - Skip hook file
- `--no-tests` - Skip test file
- `--no-config` - Skip config file
- `--no-constants` - Skip constants file
- `--no-components-dir` - Create in root
- `--dry-run` - Preview without creating
- `--force` - Overwrite existing files

**Examples:**
```bash
pnpm textor create-component Button
pnpm textor create-component Card --no-context --no-hook
pnpm textor create-component Modal --dry-run
```

## Configuration

All behavior is controlled by `.textor/config.json`:

```json
{
  "paths": {
    "pages": "src/pages",
    "features": "src/features",
    "components": "src/components",
    "layouts": "src/layouts"
  },
  "importAliases": {
    "layouts": "@/layouts",
    "features": "@/features"
  },
  "naming": {
    "routeExtension": ".astro",
    "featureExtension": ".astro",
    "componentExtension": ".astro",
    "hookExtension": ".ts",
    "testExtension": ".test.tsx"
  },
  "signatures": {
    "astro": "<!-- @generated by Textor -->",
    "typescript": "// @generated by Textor",
    "javascript": "// @generated by Textor"
  },
  "features": {
    "createComponentsDir": true,
    "createScriptsDir": true,
    "scriptsIndexFile": "Scripts/index.ts"
  },
  "components": {
    "createComponentsDir": false,
    "createContext": true,
    "createHook": true,
    "createTests": true,
    "createConfig": true,
    "createConstants": true
  }
}
```

Note: `importAliases` are optional. If a section is empty or missing an alias, Textor will use relative paths for those imports.

### Customize for Your Project

```json
{
  "paths": {
    "pages": "app/routes",
    "features": "app/modules"
  },
  "naming": {
    "routeExtension": ".tsx",
    "featureExtension": ".tsx"
  }
}
```

## Safety Features

### Signature-Based Tracking

All generated files include:
```astro
<!-- @generated by Textor -->
```
```typescript
// @generated by Textor
```

This enables safe deletion, moving, and refactoring.

### Protection Mechanisms

- ❌ Won't overwrite existing files without `--force`
- ❌ Won't delete non-Textor files without `--force`
- ✅ Dry-run mode for all destructive operations
- ✅ Automatic cleanup of empty directories
- ✅ Automatic import updates when moving

## Naming Conventions

### Routes to Files
```
/              → index.astro
/users         → users.astro
/users/[id]    → users/[id].astro
```

### Features to Components
```
users/catalog     → UsersCatalog.astro
auth/sign-in      → AuthSignIn.astro
admin/dashboard   → AdminDashboard.astro
```

### Components to Hooks
```
Button        → useButton.ts
UserProfile   → useUserProfile.ts
```

## Project Structure

```
textor/
├── bin/
│   └── textor.js              # CLI entry point
├── src/
│   ├── commands/              # Command implementations
│   │   ├── init.js
│   │   ├── add-section.js
│   │   ├── remove-section.js
│   │   ├── move-section.js
│   │   └── create-component.js
│   └── utils/                 # Shared utilities
│       ├── config.js          # Configuration management
│       ├── naming.js          # Naming transformations
│       ├── filesystem.js      # Safe file operations
│       └── templates.js       # Code generation
├── test/
│   └── naming.test.js         # Test suite
├── scripts/
│   └── validate.js            # Installation validator
├── examples/
│   └── config.example.json    # Example config
└── package.json
```

## Examples

### Building a Blog

```bash
# Home page
pnpm textor add-section / blog/home --layout Main

# Post detail
pnpm textor add-section /posts/[slug] blog/post-detail --layout Main

# Create page
pnpm textor add-section /posts/create blog/post-create --layout Main

# Reusable components
pnpm textor create-component Card
pnpm textor create-component Button
```

### E-Commerce Site

```bash
# Product pages
pnpm textor add-section / shop/home --layout Shop
pnpm textor add-section /products shop/product-listing --layout Shop
pnpm textor add-section /products/[id] shop/product-detail --layout Shop

# Cart
pnpm textor add-section /cart shop/cart --layout Shop

# Components
pnpm textor create-component ProductCard
pnpm textor create-component CartItem
```

### Refactoring

```bash
# Preview the move
pnpm textor move-section /old old/feature /new new/feature --dry-run

# Execute the move
pnpm textor move-section /old old/feature /new new/feature

# Verify with git
git diff
```

## Testing

```bash
# Run tests
pnpm test

# Validate installation
node scripts/validate.js
```

## Design Principles

1. **Explicit over implicit** - No magic behavior
2. **Safe by default** - Refuse to delete hand-written code
3. **Configurable over hardcoded** - Everything in config
4. **Reversible operations** - Add, remove, move all supported
5. **Predictable structure** - Same result every time

## Use Cases

### Perfect For
- Large teams needing consistency
- Refactoring existing codebases
- Teaching architecture patterns
- CI/CD automation
- Monorepos with shared conventions

### Not Ideal For
- Small hobby projects (too structured)
- Projects with existing strong patterns
- Teams preferring full freedom

## Troubleshooting

### Config Not Found
```bash
Error: Configuration not found
Solution: pnpm textor init
```

### File Already Exists
```bash
Error: File already exists
Solution: Remove file or use --force
```

### Not Generated by Textor
```bash
Error: Refusing to delete - not generated by Textor
Solution: Add signature manually or use --force
```

## Contributing

See `CONTRIBUTING.md` for development guidelines.

## License

MIT

## Philosophy

Textor is built on the belief that good tooling should:
- **Teach** - Structure should be self-explanatory
- **Protect** - Prevent mistakes rather than move fast
- **Adapt** - Be configurable, not opinionated
- **Reverse** - Always provide an undo path

It's designed to feel like something a principal engineer would approve - safe, predictable, and production-ready.
